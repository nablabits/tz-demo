{% load widget_tweaks %}
<h3>Ticket</h3>
{%if not items%}
  <div class="justify-content-center text-center">
    <h1><i class="fal fa-file-invoice-dollar"></i></h1>
    <h3>Ésta es la vista del ticket</h3>
    <p>Añade prendas desde la izquierda.<br>Cuando hayas acabado pincha en facturar</p>
  </div>
{%else%}
  {%for item in items%}
  <div class="d-flex">
    <div class="">
      {%include 'includes/item_string.html'%}<br>
      {{item.qty}} x {{item.price}}€ = {{item.subtotal}}€
    </div>
    <div class="ml-auto">
      {%include 'includes/action_buttons.html'%}
    </div>
  </div>
  {%endfor%}
{% endif %}
<div class="d-flex justify-content-end">
  <strong>Total:</strong>&nbsp;{{order.total}}€
</div>
<div class="d-flex justify-content-between">

    <button class="mr-1 mt-1 btn btn-outline-success" data-toggle="collapse" data-target="#add-cp">
      {%if order.customer.cp == 0%}
        <i class="fa fa-map-marker-plus"></i><br>
        Añadir CP
      {%else%}
        <i class="far fa-map-marker-smile"></i><br>
        {{order.customer.cp}}
      {%endif%}
    </button>
  <button class="mr-1 mt-1 btn btn-outline-success" data-toggle="collapse" data-target="#convert">
    <i class="fa fa-exchange"></i><br>Convertir
  </button>
  <button class="mr-1 mt-1 btn btn-outline-success" data-toggle="collapse" data-target="#invoice" {% if order.total == 0 %}disabled{% endif %}>
    <i class="fa fa-vote-yea"></i><br>Facturar
  </button>
</div>

<div class="collapse" id="add-cp">
  <form class="mt-2" action="{%url 'order_express' order.pk%}" method="post">
    {%csrf_token%}
    <div class="form-group">
      <input class="form-control" type="number" name="cp" value={{order.customer.cp}}>
    </div>
    <button class="btn btn-outline-success" type="submit">
      {%if order.customer.cp == 0%}Añadir CP{%else%}Cambiar CP{%endif%}
    </button>
  </form>
</div>

<div class="collapse" id="convert">
  <form class="mt-2" action="{%url 'order_express' order.pk%}" method="post">
    {%csrf_token%}
    <div class="form-group">
      <select class="form-control" name="customer">
        {%for customer in customers%}
          <option value="{{customer.pk}}">{{customer.name}}</option>
        {%endfor%}
      </select>
    </div>
    <button class="btn btn-outline-success" type="submit">
      Convertir en pedido regular
    </button>
  </form>
</div>

<div class="mt-4 collapse" id="invoice">
  <h3>Facturar ticket</h3>
  <form class="mt-2" action="{%url 'order_express' order.pk%}" method="post">
    {%csrf_token%}
    <div class="d-flex">
      <div class="form-group">
        {{ form.pay_method.label_tag }}
        {% render_field form.pay_method class="form-control" %}
        {% if form.pay_method.help_text %}
          <small class="form-text text-muted">{{ field.help_text }}</small>
        {% endif %}
      </div>
    </div>
    <div class="form-group">
      <label for="id_email">Añade un email para enviar el ticket<i class="fa fa-paper-plane ml-2"></i></label>
      <input class="form-control" type="email" name="email" placeholder="{no disponible aun}" disabled>
    </div>
    <button class="btn btn-outline-success" type="submit">
      <i class="fa fa-vote-yea mr-1"></i>Facturar
    </button>
  </form>
  <small>Ojo, facturar es una acción que no se puede deshacer, así que asegúrate de que todo está correcto</small>
</div>
